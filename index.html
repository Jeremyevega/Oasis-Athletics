<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Dashboard - [Your Brand]</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <div id="login">
    <h2>Client Login</h2>
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <button id="signInBtn">Sign In</button>
    <button id="signUpBtn">Sign Up</button>
  </div>

  <div class="sidebar">
    <div class="logo-placeholder">LOGO</div>
    <nav>
      <ul>
        <li><a href="#dashboard">Dashboard</a></li>
        <li><a href="#workout">Workout Plan</a></li>
        <li><a href="#nutrition">Nutrition</a></li>
        <li><a href="#progress">Progress Tracking</a></li>
        <li><a href="#notes">Notes</a></li>
        <li><a href="#contact">Contact</a></li>
        <li><a href="#admin-panel" id="adminPanelLink" style="display:none;">Admin Panel</a></li>
        <li><a href="#" id="signOutLink">Logout</a></li>
      </ul>
    </nav>
  </div>

  <div class="main-content">
    <section id="dashboard">
      <h1>Welcome back, <span id="clientName">User</span>!</h1>
      <p>Select an option from the menu to get started.</p>
    </section>

    <section id="workout">
      <h2>Workout Plan</h2>
      <div class="workout-day">
        <h3>Monday</h3>
        <ul>
          <li>
            <strong>Exercise:</strong> Bench Press<br>
            <strong>Sets/Reps:</strong> 4x10<br>
            <strong>Starting Weight:</strong> 135 lbs<br>
            <strong>Rest Time:</strong> 90 seconds<br>
            <a href="https://youtube.com" target="_blank">View Demo</a>
          </li>
        </ul>
      </div>
    </section>

    <section id="nutrition">
      <h2>Nutrition</h2>
      <div class="meal-plan">
        <h3>Breakfast</h3>
        <p>Oats with Protein Powder - 300 calories</p>
        <p>Protein: 20g, Carbs: 40g, Fat: 5g</p>
      </div>
    </section>

    <section id="progress">
      <h2>Progress Tracking</h2>
      <textarea placeholder="Workout log for today..."></textarea>
      <button>Submit Log</button>
    </section>

    <section id="notes">
      <h2>Notes</h2>
      <textarea placeholder="Write your note here..."></textarea>
      <button>Submit Note</button>
    </section>

    <section id="contact">
      <h2>Contact</h2>
      <form>
        <input type="text" placeholder="Name" required><br>
        <input type="email" placeholder="Email" required><br>
        <textarea placeholder="Message" required></textarea><br>
        <button type="submit">Send Message</button>
      </form>
    </section>

    <section id="admin-panel" style="display:none;">
      <h2>Admin Panel</h2>
      <label for="clientSelect">Select Client:</label>
      <select id="clientSelect">
        <option disabled selected>Choose a client</option>
      </select>
      <hr>
      <h3>Workout Plan</h3>
      <div id="workoutEditor">
        <div id="exerciseList"></div>
        <button id="addWorkoutBtn">+ Add Exercise</button>
      </div>
      <hr>
      <h3>Nutrition Plan</h3>
      <div id="mealEditor">
        <div id="mealList"></div>
        <button id="addMealBtn">+ Add Meal</button>
        <div style="margin-top: 10px;">
          <strong>Total for Day:</strong>
          <p id="dailyTotal">Calories: 0 | Protein: 0g | Carbs: 0g | Fats: 0g</p>
        </div>
      </div>
      <hr>
      <h3>Trainer Notes to Client</h3>
      <textarea id="trainerNote" placeholder="Enter message for client..."></textarea>
      <h3>Client Notes to Trainer</h3>
      <div id="clientNotesOutput">Loading client notes...</div>
      <hr>
      <button id="previewBtn">üîç Preview Client Dashboard</button>
      <button id="undoBtn">‚Ü©Ô∏è Undo Last Change</button>
    </section>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBWzRFnpvX10kF7eCBezX3vY9MBVXlpV6g",
      authDomain: "mytrainingapp-3a352.firebaseapp.com",
      projectId: "mytrainingapp-3a352",
      storageBucket: "mytrainingapp-3a352.appspot.com",
      messagingSenderId: "802120004680",
      appId: "1:802120004680:web:ac9496211c8d3de7f9147d"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginDiv = document.getElementById('login');
    const sidebar = document.querySelector('.sidebar');
    const mainContent = document.querySelector('.main-content');
    const clientNameSpan = document.getElementById('clientName');
    const signInBtn = document.getElementById('signInBtn');
    const signUpBtn = document.getElementById('signUpBtn');
    const signOutLink = document.getElementById('signOutLink');
    const adminPanelLink = document.getElementById('adminPanelLink');
    const clientSelect = document.getElementById('clientSelect');

    auth.onAuthStateChanged(user => {
      if (user) {
        const userEmail = user.email;
        loginDiv.style.display = 'none';
        sidebar.style.display = 'block';
        mainContent.style.display = 'block';
        clientNameSpan.textContent = userEmail.split('@')[0];

        adminPanelLink.style.display = 'none';
        document.getElementById('admin-panel').style.display = 'none';

        if (userEmail === 'jeremyevega@icloud.com') {
          adminPanelLink.style.display = 'block';
          document.getElementById('admin-panel').style.display = 'block';

          db.collection('clients').get().then(snapshot => {
            snapshot.forEach(doc => {
              const opt = document.createElement('option');
              opt.value = doc.id;
              opt.textContent = doc.data().email;
              clientSelect.appendChild(opt);
            });
          });  // ‚Äî‚Äî‚Äî When admin picks a client, load their saved data into the editors ‚Äî‚Äî‚Äî
  clientSelect.addEventListener('change', () => {
    const clientId = clientSelect.value;
    if (!clientId) return;
    db.collection('clients').doc(clientId).get().then(doc => {
      if (!doc.exists) return;
      const data = doc.data();

      // Workout editor
      exerciseList.innerHTML = '';
      (data.workout || []).forEach(w => createExerciseInputs(w));

      // Meal editor
      mealList.innerHTML = '';
      (data.meals || []).forEach(m => {
        const mealDiv        = document.createElement('div');
        const nameInput      = document.createElement('input');
        const caloriesInput  = document.createElement('input');
        const proteinInput   = document.createElement('input');
        const carbsInput     = document.createElement('input');
        const fatsInput      = document.createElement('input');

        nameInput.placeholder     = 'Meal name';    nameInput.value     = m.name     || '';
        caloriesInput.placeholder = 'Calories';     caloriesInput.value = m.calories|| '';
        proteinInput.placeholder  = 'Protein';      proteinInput.value  = m.protein || '';
        carbsInput.placeholder    = 'Carbs';        carbsInput.value    = m.carbs   || '';
        fatsInput.placeholder     = 'Fats';         fatsInput.value     = m.fats    || '';

        [nameInput, caloriesInput, proteinInput, carbsInput, fatsInput].forEach(input => {
          input.style.display      = 'block';
          input.style.marginBottom = '5px';
          input.addEventListener('input', saveMealData);
          mealDiv.appendChild(input);
        });

        mealList.appendChild(mealDiv);
      });

      // Trainer note
      document.getElementById('trainerNote').value = data.trainerNote || '';
    });
  });

        }  // ‚Äî‚Äî‚Äî If a regular (non-admin) client has just signed in, fetch & display their plan ‚Äî‚Äî‚Äî
  if (userEmail !== 'jeremyevega@icloud.com') {
    const clientId = user.uid;
    db.collection('clients').doc(clientId).get().then(doc => {
      if (!doc.exists) return;
      const data = doc.data();

      // Workout section
      const workoutList = document.querySelector('#workout .workout-day ul');
      workoutList.innerHTML = '';
      (data.workout || []).forEach(ex => {
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>Exercise:</strong> ${ex.name}<br>
          <strong>Sets/Reps:</strong> ${ex.setsReps}<br>
          <strong>Starting Weight:</strong> ${ex.weight} lbs<br>
          <strong>Rest Time:</strong> ${ex.rest} seconds<br>
          <a href="${ex.link}" target="_blank">View Demo</a>
        `;
        workoutList.appendChild(li);
      });

      // Nutrition section
      const nutritionSection = document.getElementById('nutrition');
      nutritionSection.querySelectorAll('.meal-plan').forEach(el => el.remove());
      (data.meals || []).forEach(meal => {
        const div = document.createElement('div');
        div.classList.add('meal-plan');
        div.innerHTML = `
          <h3>${meal.name}</h3>
          <p>${meal.name} ‚Äì ${meal.calories} calories</p>
          <p>Protein: ${meal.protein}g, Carbs: ${meal.carbs}g, Fat: ${meal.fats}g</p>
        `;
        nutritionSection.appendChild(div);
      });
    });
  }

      } else {
        loginDiv.style.display = 'block';
        sidebar.style.display = 'none';
        mainContent.style.display = 'none';
      }
    });

    signInBtn.addEventListener('click', () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password).catch(err => alert(err.message));
    });

    signUpBtn.addEventListener('click', () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(cred => {
          return db.collection('clients').doc(cred.user.uid).set({
            email: cred.user.email,
            meals: [],
            workout: [],
            trainerNote: "Welcome to your program! Let‚Äôs get to work!"
          });
        })
        .catch(err => alert(err.message));
    });

    signOutLink.addEventListener('click', e => {
      e.preventDefault();
      auth.signOut();
    });

    document.querySelectorAll('nav ul li a').forEach(link => {
      if (link.id === 'signOutLink') return;
      link.addEventListener('click', e => {
        e.preventDefault();
        document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
        const id = link.getAttribute('href').substring(1);
        document.getElementById(id).style.display = 'block';
      });
    });

    document.getElementById('previewBtn').addEventListener('click', () => {
      const clientId = clientSelect.value;
      if (!clientId) return alert('Please select a client first.');
      window.open(`preview.html?id=${clientId}`, '_blank');
    });

    const exerciseList = document.getElementById('exerciseList');
    const addWorkoutBtn = document.getElementById('addWorkoutBtn');

   function createExerciseInputs(data = {}) {
  const container = document.createElement('div');
  container.classList.add('exercise-block');
  container.style.marginBottom = '20px';

  // Day selector for this exercise
  const daySelect = document.createElement('select');
  ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday']
    .forEach(d => {
      const opt = document.createElement('option');
      opt.value = d;
      opt.textContent = d;
      if (data.day === d) opt.selected = true;
      daySelect.appendChild(opt);
    });
  container.appendChild(daySelect);

  // Exercise Name
  const nameInput = document.createElement('input');
  nameInput.placeholder = 'Exercise name';
  nameInput.value = data.name || '';
  container.appendChild(nameInput);

  // Sets x Reps
  const setsRepsInput = document.createElement('input');
  setsRepsInput.placeholder = 'Sets x Reps';
  setsRepsInput.value = data.setsReps || '';
  container.appendChild(setsRepsInput);

  // Weight
  const weightInput = document.createElement('input');
  weightInput.placeholder = 'Weight';
  weightInput.value = data.weight || '';
  container.appendChild(weightInput);

  // Rest Time
  const restInput = document.createElement('input');
  restInput.placeholder = 'Rest Time';
  restInput.value = data.rest || '';
  container.appendChild(restInput);

  // Demo link (URL)
  const linkInput = document.createElement('input');
  linkInput.placeholder = 'Demo link (URL)';
  linkInput.value = data.link || '';
  container.appendChild(linkInput);

  // Delete this single exercise
  const delBtn = document.createElement('button');
  delBtn.type = 'button';
  delBtn.textContent = 'Delete Exercise';
  delBtn.addEventListener('click', () => {
    container.remove();
    saveWorkoutData();
  });
  container.appendChild(delBtn);

  exerciseList.appendChild(container);
}

    addWorkoutBtn.addEventListener('click', () => {
      createExerciseInputs();
      saveWorkoutData();
    });

function saveWorkoutData() {
  const clientId = clientSelect.value;
  if (!clientId) return;

  const exercises = [];
  const blocks = exerciseList.querySelectorAll('.exercise-block');

  blocks.forEach(block => {
    const day = block.querySelector('select').value;
    const inputs = block.querySelectorAll('input');
    exercises.push({
      day:      day,
      name:     inputs[0].value,
      setsReps: inputs[1].value,
      weight:   inputs[2].value,
      rest:     inputs[3].value,
      link:     inputs[4].value
    });
  });

  db.collection('clients').doc(clientId).update({ workout: exercises });
}

    const mealList = document.getElementById('mealList');
    const addMealBtn = document.getElementById('addMealBtn');
    const dailyTotal = document.getElementById('dailyTotal');

    addMealBtn.addEventListener('click', () => {
  const meal = document.createElement('div');
  meal.classList.add('meal-block');

  // Day selector for this meal
  const mealDay = document.createElement('select');
  ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday']
    .forEach(d => {
      const opt = document.createElement('option');
      opt.value = d;
      opt.textContent = d;
      mealDay.appendChild(opt);
    });
  meal.appendChild(mealDay);

  // Meal Name
  const nameInput = document.createElement('input');
  nameInput.placeholder = 'Meal name';
  meal.appendChild(nameInput);

  // Calories
  const calInput = document.createElement('input');
  calInput.placeholder = 'Calories';
  meal.appendChild(calInput);

  // Protein
  const proteinInput = document.createElement('input');
  proteinInput.placeholder = 'Protein';
  meal.appendChild(proteinInput);

  // Carbs
  const carbsInput = document.createElement('input');
  carbsInput.placeholder = 'Carbs';
  meal.appendChild(carbsInput);

  // Fats
  const fatsInput = document.createElement('input');
  fatsInput.placeholder = 'Fats';
  meal.appendChild(fatsInput);

  // Delete this single meal
  const delMealBtn = document.createElement('button');
  delMealBtn.type = 'button';
  delMealBtn.textContent = 'Delete Meal';
  delMealBtn.addEventListener('click', () => {
    meal.remove();
    saveMealData();
  });
  meal.appendChild(delMealBtn);
      
      mealList.appendChild(meal);
    });

    function saveMealData() {
  const clientId = clientSelect.value;
  if (!clientId) return;

  const meals = [];
  let totalCals = 0, totalProtein = 0, totalCarbs = 0, totalFats = 0;
  const blocks = mealList.querySelectorAll('.meal-block');

  blocks.forEach(block => {
    const day = block.querySelector('select').value;
    const inputs = block.querySelectorAll('input');
    const cals = parseInt(inputs[1].value) || 0;
    const prot = parseInt(inputs[2].value) || 0;
    const crbs = parseInt(inputs[3].value) || 0;
    const fat  = parseInt(inputs[4].value) || 0;

    meals.push({
      day:      day,
      name:     inputs[0].value,
      calories: cals,
      protein:  prot,
      carbs:    crbs,
      fats:     fat
    });

    totalCals     += cals;
    totalProtein += prot;
    totalCarbs   += crbs;
    totalFats    += fat;
  });

  dailyTotal.textContent =
    `Calories: ${totalCals} | Protein: ${totalProtein}g | Carbs: ${totalCarbs}g | Fats: ${totalFats}g`;

  db.collection('clients').doc(clientId).update({ meals });
}
    
  </script>
</body>
</html>
