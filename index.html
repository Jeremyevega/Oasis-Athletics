<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client Dashboard - [Your Brand]</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- LOGIN -->
  <div id="login">
    <h2>Client Login</h2>
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <button id="signInBtn">Sign In</button>
    <button id="signUpBtn">Sign Up</button>
  </div>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="logo-placeholder">LOGO</div>
    <nav>
      <ul>
        <li><a href="#dashboard">Dashboard</a></li>
        <li><a href="#workout">Workout Plan</a></li>
        <li><a href="#nutrition">Nutrition</a></li>
        <li><a href="#progress">Progress Tracking</a></li>
        <li><a href="#notes">Notes</a></li>
        <li><a href="#contact">Contact</a></li>
        <li><a href="#admin-panel" id="adminPanelLink" style="display:none;">Admin Panel</a></li>
        <li><a href="#" id="signOutLink">Logout</a></li>
      </ul>
    </nav>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <section id="dashboard">
      <h1>Welcome back, <span id="clientName">User</span>!</h1>
      <p>Select an option from the menu to get started.</p>
    </section>

    <section id="workout">
      <h2>Workout Plan</h2>
      <div class="workout-day">
        <!-- Example static content; will be replaced in preview -->
        <h3>Monday</h3>
        <ul>
          <li>
            <strong>Exercise:</strong> Bench Press<br>
            <strong>Sets/Reps:</strong> 4x10<br>
            <strong>Starting Weight:</strong> 135 lbs<br>
            <strong>Rest Time:</strong> 90 seconds<br>
            <a href="https://youtube.com" target="_blank">View Demo</a>
          </li>
        </ul>
      </div>
    </section>

    <section id="nutrition">
      <h2>Nutrition</h2>
      <div class="meal-plan">
        <!-- Static example -->
        <h3>Breakfast</h3>
        <p>Oats with Protein Powder - 300 calories</p>
        <p>Protein: 20g, Carbs: 40g, Fat: 5g</p>
      </div>
    </section>

    <section id="progress">
      <h2>Progress Tracking</h2>
      <textarea placeholder="Workout log for today..."></textarea>
      <button>Submit Log</button>
    </section>

    <section id="notes">
      <h2>Notes</h2>
      <textarea placeholder="Write your note here..."></textarea>
      <button>Submit Note</button>
    </section>

    <section id="contact">
      <h2>Contact</h2>
      <form>
        <input type="text" placeholder="Name" required><br>
        <input type="email" placeholder="Email" required><br>
        <textarea placeholder="Message" required></textarea><br>
        <button type="submit">Send Message</button>
      </form>
    </section>

    <!-- ADMIN PANEL -->
    <section id="admin-panel" style="display:none;">
      <h2>Admin Panel</h2>
      <label for="clientSelect">Select Client:</label>
      <select id="clientSelect">
        <option disabled selected>Choose a client</option>
      </select>
      <hr>

      <!-- Workout Plan Creator -->
      <h3>Workout Plan</h3>
      <div id="workoutEditor">
        <div id="exerciseList"></div>
        <button id="addWorkoutBtn">+ Add Exercise</button>
      </div>
      <hr>

      <!-- Nutrition Plan Creator -->
      <h3>Nutrition Plan</h3>
      <div id="mealEditor">
        <h4>Meals</h4>
        <div id="mealsList"></div>
        <button id="addMealBtn">+ Add Meal</button>
        <div style="margin-top:10px;"><strong>Total for Day:</strong> <span id="dailyTotal">0 kcal | P:0g C:0g F:0g</span></div>
      </div>
      <hr>

      <h3>Trainer Notes to Client</h3>
      <textarea id="trainerNote" placeholder="Enter message for client..."></textarea>
      <h3>Client Notes to Trainer</h3>
      <div id="clientNotesOutput">Loading client notes...</div>
      <hr>

      <button id="previewBtn">üîç Preview Client Dashboard</button>
      <button id="clearBtn">üßπ Clear Plan</button>
      <button id="undoBtn">‚Ü©Ô∏è Undo Last Change</button>
    </section>
  </div>

  <script>
    // --- Firebase & Auth Setup ---
    const firebaseConfig = { /* your config */ };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- UI Elements ---
    const loginDiv = document.getElementById('login');
    const sidebar = document.querySelector('.sidebar');
    const mainContent = document.querySelector('.main-content');
    const clientNameSpan = document.getElementById('clientName');
    const signInBtn = document.getElementById('signInBtn');
    const signUpBtn = document.getElementById('signUpBtn');
    const signOutLink = document.getElementById('signOutLink');
    const adminPanelLink = document.getElementById('adminPanelLink');
    const clientSelect = document.getElementById('clientSelect');
    const exerciseList = document.getElementById('exerciseList');
    const addWorkoutBtn = document.getElementById('addWorkoutBtn');
    const mealsList = document.getElementById('mealsList');
    const addMealBtn = document.getElementById('addMealBtn');
    const clearBtn = document.getElementById('clearBtn');
    const undoBtn = document.getElementById('undoBtn');

    let lastSavedState = {};

    // --- Auth Listener ---
    auth.onAuthStateChanged(user => {
      if (user) {
        loginDiv.style.display = 'none';
        sidebar.style.display = 'block';
        mainContent.style.display = 'block';
        clientNameSpan.textContent = user.email.split('@')[0];

        adminPanelLink.style.display = 'none';
        document.getElementById('admin-panel').style.display = 'none';
        if (user.email === 'jeremyevega@icloud.com') {
          adminPanelLink.style.display = 'block';
          document.getElementById('admin-panel').style.display = 'block';
          db.collection('clients').get().then(snap => {
            snap.forEach(doc => {
              const opt = document.createElement('option');
              opt.value = doc.id;
              opt.textContent = doc.data().email;
              clientSelect.appendChild(opt);
            });
          });
        }
      } else {
        loginDiv.style.display = 'block';
        sidebar.style.display = 'none';
        mainContent.style.display = 'none';
      }
    });

    // --- Auth Actions ---
    signInBtn.onclick = () => {
      const email = document.getElementById('email').value;
      const pass = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
    };
    signUpBtn.onclick = () => {
      const email = document.getElementById('email').value;
      const pass = document.getElementById('password').value;
      auth.createUserWithEmailAndPassword(email, pass)
        .then(cred => db.collection('clients').doc(cred.user.uid).set({
          email: cred.user.email,
          meals: [], workout: [], trainerNote: ''
        }))
        .catch(e => alert(e.message));
    };
    signOutLink.onclick = e => { e.preventDefault(); auth.signOut(); };

    // --- Navigation ---
    document.querySelectorAll('nav a').forEach(a => {
      if (a.id==='signOutLink') return;
      a.onclick = e => {
        e.preventDefault();
        document.querySelectorAll('section').forEach(sec=>sec.style.display='none');
        document.getElementById(a.getAttribute('href').slice(1)).style.display='block';
      };
    });

    // --- Load & Sync Client Data ---
    clientSelect.onchange = () => {
      const id = clientSelect.value;
      db.collection('clients').doc(id).get().then(doc => {
        if (!doc.exists) return;
        const data = doc.data();
        // Clear editors
        exerciseList.innerHTML='';
        mealsList.innerHTML='';
        // Load workout
        (data.workout||[]).forEach(ex=>createExerciseInputs(ex));
        // Load meals
        (data.meals||[]).forEach(me=>createMealInputs(me));
        // Notes
        document.getElementById('trainerNote').value=data.trainerNote||'';
        displayClientNotes(data.clientNotes||[]);
        updateDailyTotals();
        lastSavedState = JSON.parse(JSON.stringify(data));
      });
    };

    // --- Preview, Clear, Undo ---
    document.getElementById('previewBtn').onclick = () => {
      const id = clientSelect.value;
      if(!id) return alert('Select a client!');
      window.open(`preview.html?id=${id}`,'_blank');
    };
    clearBtn.onclick = () => {
      exerciseList.innerHTML=''; mealsList.innerHTML='';
      document.getElementById('trainerNote').value='';
      document.getElementById('clientNotesOutput').innerHTML='';
      updateDailyTotals(); saveAllData();
    };
    undoBtn.onclick = () => {
      if(!lastSavedState) return;
      exerciseList.innerHTML=''; mealsList.innerHTML='';
      (lastSavedState.workout||[]).forEach(e=>createExerciseInputs(e));
      (lastSavedState.meals||[]).forEach(m=>createMealInputs(m));
      document.getElementById('trainerNote').value=lastSavedState.trainerNote||'';
      updateDailyTotals();
    };

    // --- Workout Logic ---
    function createExerciseInputs(data={}) {
      const c=document.createElement('div'); c.style.marginBottom='10px';
      ['Exercise name','Sets x Reps','Weight','Rest time','Video link'].forEach((ph,i)=>{
        const inp=document.createElement('input');
        inp.placeholder=ph;
        inp.value=data[['name','setsReps','weight','rest','link'][i]]||'';
        inp.style.display='block'; inp.style.margin='5px 0';
        inp.oninput=saveWorkoutData;
        c.appendChild(inp);
      });
      exerciseList.appendChild(c);
    }
    addWorkoutBtn.onclick = () => { createExerciseInputs(); saveWorkoutData(); };
    function saveWorkoutData() {
      const id=clientSelect.value; if(!id) return;
      const w=[];
      exerciseList.querySelectorAll('div').forEach(d=>{
        const i=d.querySelectorAll('input');
        w.push({ name:i[0].value, setsReps:i[1].value, weight:i[2].value, rest:i[3].value, link:i[4].value });
      });
      db.collection('clients').doc(id).update({ workout:w });
    }

    // --- Meal Logic ---
    function createMealInputs(data={}) {
      const c=document.createElement('div'); c.className='meal-block'; c.style.marginBottom='10px';
      [['Meal name','name'],['Calories','calories'],['Protein (g)','protein'],['Carbs (g)','carbs'],['Fats (g)','fats']].forEach((f,i)=>{
        const inp=document.createElement('input');
        inp.placeholder=f[0];
        inp.type = i>0?'number':'text';
        inp.value=data[f[1]]||'';
        inp.style.display='block'; inp.style.margin='5px 0';
        inp.oninput=()=>{ saveMealData(); updateDailyTotals(); };
        c.appendChild(inp);
      });
      const rem=document.createElement('button'); rem.textContent='‚úñÔ∏è Remove'; rem.onclick=()=>{ c.remove(); saveMealData(); updateDailyTotals(); };
      c.appendChild(rem);
      mealsList.appendChild(c);
    }
    addMealBtn.onclick = () => { createMealInputs(); saveMealData(); updateDailyTotals(); };
    function saveMealData() {
      const id=clientSelect.value; if(!id) return;
      const m=[];
      mealsList.querySelectorAll('.meal-block').forEach(d=>{
        const i=d.querySelectorAll('input');
        m.push({ name:i[0].value, calories:+i[1].value||0, protein:+i[2].value||0, carbs:+i[3].value||0, fats:+i[4].value||0 });
      });
      db.collection('clients').doc(id).update({ meals:m });
    }

    function updateDailyTotals() {
      let c=0,p=0,cb=0,f=0;
      mealsList.querySelectorAll('.meal-block').forEach(d=>{ const i=d.querySelectorAll('input'); c+=+i[1].value||0; p+=+i[2].value||0; cb+=+i[3].value||0; f+=+i[4].value||0; });
      document.getElementById('dailyTotal').textContent = `${c} kcal | P:${p}g C:${cb}g F:${f}g`;
    }

    // --- Notes Display ---
    function displayClientNotes(notes=[]) {
      const out=document.getElementById('clientNotesOutput');
      out.innerHTML = notes.length ? notes.map(n=>`<p>‚Ä¢ ${n}</p>`).join('') : '<p>No notes yet.</p>';
    }

    // --- Save all (for clear) ---
    function saveAllData() { saveWorkoutData(); saveMealData(); const id=clientSelect.value; if(!id) return; db.collection('clients').doc(id).update({ trainerNote:document.getElementById('trainerNote').value }); }
  </script>
</body>
</html>
